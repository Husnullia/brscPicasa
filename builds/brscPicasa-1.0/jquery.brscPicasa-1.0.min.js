// brscPicasa v1.0 - jQuery plugin for displaying photos from Google Picasa Web Albums.
// c) 2010 Maciej 'barszcz' Marczewski - www.barszcz.info - maciej@marczewski.net.pl
// Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
(function(a){a.fn.brscPicasa=function(e){var d="brscPicasa";var f={user:"",album_id:"",album_name:"",photo_id:"",authkey:"",albums_thumbsize:"32c",albums_titles:true,photos_thumbsize:"32c",photos_linkedsize:"800",photos_titles:false,photo_displaysize:"640",photo_linkedsize:"d",photo_title:false,mode:"from_link",from_link_target:"",classes:{link_replacer:"",container:"",album_list:"",photos_list:"",list_item:"",single_item:"",link_with_image:"",photo:"",title:""},callback:false};var g=a.extend(true,{},f,a.fn.brscPicasa.defaults,e);var b="http://picasaweb.google.com/data/feed/base/user/";var h="http://picasaweb.google.com/data/entry/base/user/";var c=0;return this.each(function(){var k=this;function j(){if(!g.mode||!g.user||!i[g.mode]){g.mode="from_link"}i[g.mode].apply(k,[g]);if(a.isFunction(g.callback)){var l;l=setInterval(function(){if(c<=0){clearInterval(l);g.callback.call(k)}},100)}}var i={albums:function(n){c++;var m="";if(n.authkey){m="&authkey="+n.authkey}var l=a(this);a.getJSON(b+n.user+"?kind=album&alt=json&thumbsize="+n.albums_thumbsize+"&fields=entry(title,link[@rel='alternate'],media:group/media:thumbnail)&visibility=all"+m,function(p){var o=p.feed.entry||[];var q=a('<ul class="'+d+"List "+d+"Albums "+n.classes.album_list+'"></ul>');for(var r=0;r<o.length;++r){var s=o[r];$item=a('<li class="'+d+"ListItem "+n.classes.list_item+'"><a class="'+d+"LinkWithImage "+n.classes.link_with_image+'" href="'+s.link[0].href+'"><img class="'+d+"Photo "+n.classes.thumbnail+'" src="'+s.media$group.media$thumbnail[0].url+'" width="'+s.media$group.media$thumbnail[0].width+'" height="'+s.media$group.media$thumbnail[0].height+'" /></a></li>');if(n.albums_titles){$item.children().append('<span class="'+d+"Title "+n.classes.title+'">'+s.title.$t+"</span>")}q.append($item)}q.wrap('<div class="'+d+"Container "+n.classes.container+'" />').parent().appendTo(l);c--})},photos:function(n){c++;var m="";if(n.authkey){m="&authkey="+n.authkey}if(n.album_id){album_url_part="/albumid/"+n.album_id}else{if(n.album_name){album_url_part="/album/"+n.album_name}else{album_url_part=""}}var l=a(this);if(n.photos_linkedsize!=="none"){imgmax="&imgmax="+n.photos_linkedsize}else{imgmax=""}a.getJSON(b+n.user+album_url_part+"?kind=photo&alt=json&thumbsize="+n.photos_thumbsize+imgmax+"&fields=entry(title,media:group(media:thumbnail, media:content))&visibility=all"+m,function(p){var o=p.feed.entry||[];var q=a('<ul class="'+d+"List "+d+"Photos "+n.classes.photos_list+'"></ul>');for(var r=0;r<o.length;++r){var s=o[r];$item=a('<li class="'+d+"ListItem "+n.classes.list_item+'"><img class="'+d+"Photo "+n.classes.thumbnail+'" src="'+s.media$group.media$thumbnail[0].url+'" width="'+s.media$group.media$thumbnail[0].width+'" height="'+s.media$group.media$thumbnail[0].height+'" /></li>');if(n.photos_linkedsize!=="none"){$item.children().wrap('<a class="'+d+"LinkWithImage "+n.classes.link_with_image+'" href="'+s.media$group.media$content[0].url+'"></a>')}if(n.photos_titles){$item.find("img").after('<span class="'+d+"Title "+n.classes.title+'">'+s.title.$t+"</span>")}q.append($item)}q.wrap('<div class="'+d+"Container "+n.classes.container+'" />').parent().appendTo(l);c--})},photo:function(n){var m="";if(n.authkey){m="&authkey="+n.authkey}if(!n.photo_id){a.error("photo_id option is not set for jQuery."+d);return}if(n.album_id){album_url_part="/albumid/"+n.album_id}else{if(n.album_name){album_url_part="/album/"+n.album_name}else{a.error("album_id or album_name option must be set for jQuery."+d);return}}c++;var l=a(this);if(n.photo_linkedsize!=="none"){imgmax="&imgmax="+n.photo_linkedsize}else{imgmax=""}a.getJSON(h+n.user+album_url_part+"/photoid/"+n.photo_id+"?kind=photo&alt=json&thumbsize="+n.photo_displaysize+imgmax+"&fields=title,media:group(media:thumbnail, media:content)&visibility=all"+m,function(o){var p=o.entry||{};$div=a('<div class="'+d+"SingleItem "+n.classes.single_item+'"><img class="'+d+"Photo "+n.classes.photo+'" src="'+p.media$group.media$thumbnail[0].url+'" width="'+p.media$group.media$thumbnail[0].width+'" height="'+p.media$group.media$thumbnail[0].height+'" /></div>');if(n.photo_linkedsize!=="none"){$div.children().wrap('<a class="'+d+"LinkWithImage "+n.classes.link_with_image+'" href="'+p.media$group.media$content[0].url+'"></a>')}if(n.photo_title){$div.find("img").after('<span class="'+d+"Title "+n.classes.title+'">'+p.title.$t+"</span>")}$div.wrap('<div class="'+d+"Container "+n.classes.container+'" />').parent().appendTo(l);c--})},from_link:function(m){var l=a(this);if(l.is('a[href^="http://picasaweb.google."]')){$links=l}else{$links=l.find('a[href^="http://picasaweb.google."]')}$links.each(function(){m.authkey="";if(this.search){var o=this.search.replace("?","").split("&");for(var n=0;n<o.length;n++){param=o[n].split("=");if(param[0]==="authkey"){m.authkey=param[1];break}}}var p=this.pathname.split("/");if(p.length==3){m.user=p[1];m.album_name=p[2];if(this.hash){m.photo_id=this.hash.replace("#","");m.mode="photo"}else{m.mode="photos"}}else{if(p.length==2){m.user=p[1];m.mode="albums"}else{return}}if(!m.from_link_target){$target=a('<div class="'+d+"LinkReplacer "+m.classes.link_replacer+'"></div>');a(this).replaceWith($target)}else{$target=a(m.from_link_target)}return i[m.mode].apply($target,[m])})}};j()})};a.fn.brscPicasa.defaults={}})(jQuery);